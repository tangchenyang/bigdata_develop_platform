# 数据工程与产品
很多技术人不想关注资本的世界，所以才选择做技术。 数据人身在局中， 数据工程建设脱离不了业务，而业务就是商业的不同展现形式。  
我们想象一下，有一家企业，经历了三年的从0到1野蛮生长期，取得了很大的成就，扩展了很多的客户，沉淀了很多的数据；  
同时也慢慢进入了发展缓慢期，公司规模越来越大，扩展新的业务越来越难，利润率也开始下降。  
便逐渐开始焦虑，思考如能能改变。  
偶然听到外界嘈杂的声音中传来的一些关键字：大数据时代，数字化转型，便将视线转向了沉淀了许久的数据，想从这一堆堆数据中挖掘点什么出来。  
眼前这无尽的数据在这个数据就是黄金的时代，放在自己手中却看起来像是一堆废物，寄希望于业内的数据专家，为为自己定制一个变废为宝的计划。

## 数据工程

### 什么是数据工程

我们先看看什么是软件工程, 根据维基百科的定义，软件工程是：应用计算机科学理论和技术以及工程管理原则和方法，按预算和进度，实现满足用户要求的软件产品的定义、开发、和维护的工程或进行研究的学科。  
简而言之就是，对某一特定需求进行系统化、模块化、规范化的一个过程。  
数据工程也是如此，而数据工程的过程通常指的是：从数据的采集、存储、加工到应用的整个流程的工程化。  

### 数据工程经历了哪些时代
其实我们对数据计算或者存储的需求从古代就产生了，古时候钱庄存钱取钱背后的用算盘记账和对账等过程，与现代的数据工程如出一辙。只是相对来说需求少，体量小。
而从计算机时代以来，数据就有了翻天覆地的变化。
- 计算机时代  
在80、90年代，随着计算机慢慢普及，以及Excel的诞生，而企业财务人员的主要工具，从便携式计算器变成了小型计算机，保存数据和计算数据的主要手段也变成了Excel。  
这时候企业的用户还相对较少，产生的数据也没有特别的多，基本上一到两个财务人员就能完成公司所需的分析工作。

- 信息化时代  
在2000年左右，网页数据库等信息技术逐渐在各行各业深入应用，企业的业务流程逐渐自动化，很多企业都构建了自己的EPR系统，并且产生了很多的数据保存在数据库中。  
这个时候已经有很多BI项目和工具产生，主要是通过关系型数据库提供的计算能力，再加上web 页面的图表来做报表的展示。

- 大数据时代  
大数据时代，企业的数据从 GB 增长到 TB 甚至 PB，数据爆发式增长，传统关系型数据库如 Mysql/Oracle/SQL Server 等不能满足海量数据的计算要求  
这时候出现了很多分布式计算引擎如Hadoop/Spark，还有一些MPP架构的数据库如GreenPlum/DeepGreen/TiDB/Redshift等，这些组件的出现解决了海量数据的计算和存储的问题。  
在吞吐量不是大问题之后，很多公司开始追求时效性，也就是从批处理往流处理发展。从离线数仓到实时数仓，从数据仓库到数据湖，也衍生了很多流批一体的架构如Lambda架构和Kappa架构等等。  
从战略角度来看，从CRM 发展到 DMP，从DMP 到CDP，再到数据中台，再到 数据网格 DataMesh。在这个时代爆发出了各种让人眼花缭乱的产品或者解决方案。。
本篇文章我们就简单介绍一下这些跟数据息息相关的内容。


### 数据工程包括哪些内容
有需求就会有市场，那我们先来看看都有哪些数据/大数据相关的岗位  
- 大数据平台开发工程师
- 大数据开发工程师  
- 数据开发工程师
- 数据仓库工程师
- ETL工程师
- 数据平台开发工程师
- 数据分析师
- 数据挖掘工程师
- 数据科学家
- 算法/机器学习工程师 等


#### 大数据开发平台
所有的软件都要运行在硬件之上，而大数据的计算也都要运行在各种大数据组件之上，各种大数据组件集成起来提供数据计算能力的这集合，就是大数据开发平台。
大数据平台为数据工程师或者数据分析师等提供数据的开发能力（如计算、存储、分析、安全审计、监控告警等），在此平台之上做各种各样的数据开发

- 自建平台/私有云
企业自己采购硬件、搭建机房、维护设备、维护软件等所有人力和经济成本，均由企业自己承担。
这里没有将自建平台和私有云做区分，是因为相对于企业自身来说，都需要投入相同的成本，区别只是这个工作是在不同的部门而已。
  - 优点
    - 网络只对本地开放，安全性高
    - 自定义程度高，灵活性高
    - 可控性更高，服务器类型，软件版本等可以深度自定义
    - 可以本地开发
  - 缺点
    - 运维成本高，需要为更多的基础设施付费，需要独立的运维团队
  - 例子
    - 自建 HUAWEI FusionInsight 集群
    - 自建 CDH 集群等
- 云平台
企业租赁云厂商提供的PaaS服务，在此服务之上直接做数据开发
  - 优点
    - 开箱即用，无需太多额外的运维成本
    - 按需付费，弹性扩容，无需在前期就投入大量的技术设施成本
  - 缺点
    - 安全性不如本地自建平台，服务器在公网上，需要定义防火墙规则来限制访问，极小可能存在被侵入的风险
    - 灵活性较差，PaaS提供的组件组合以及版本往往是固定的，并且几乎不可能使用到最新版本的开源组件
  - 例子
    - AWS 
    - Azure 
    - 阿里云 等

#### 数据平台
有了大数据开发平台，但测试这个平台只是具备了数据开发的能力，并没有提供任何数据。  
用户想要做分析的时候还是需要经过繁琐的数据导入、数据清晰、建模等繁琐的过程，才能够真正地使用数据。  
而数据平台的出现就是为了解决这些问题，为企业的数据分析挖掘、商业洞察、战略决策提供统一的、标准的、集成的、可靠的、易用的数据支撑服务。  
常见的数据平台有数据仓库、数据湖、数据中台等，我们来看一看他们的异同。  
##### 数据仓库  
数据仓库是诞生比较早的数据平台，广义上来说它不是一种具体的技术，而是一种方法、一套架构。它可以构建在如MySql/Oracle等传统的RDBMS上，也可以构建在如Hadoop、Hive等分布式架构之上。  
数据仓库主要是针对特定主题的结构化的数据，SQL是主要语言，一般采用维度建模的方式，有清晰完善的层级结构，主要包括ODS层、DW层、ADS层。  
我们来看一张数据仓库层级 todo add image 
- ODS 层
ODS(Operational Data Store)层又称贴源层, 是从外部系统将操作型数据导入平台之后的第一层，保存了操作型数据最原始的状态。  
数据从这一层开始将各种外部数据集成在数据平台中，并且无需重复从外部数据中重复采集相同的数据。  

- DW 层
DW(Data Warehouse)层，是数仓中最核心的一个层级，其中包含维度层 DIM, 数据明细层 DWD, 数据服务层 DWS
  - DIM (Dimension)  
    维度表中主要用来存放一些具有确定含义、不会随着业务发生变化的的维度信息，如时间维度、地区维度、用户维度、商品维度
    其中如用户维度、商品维度等，虽然不会随着业务发生快速变化，但可能会随着公司发展阶段，用户体量等因素而缓慢变化，因此又被细分为缓慢变化维度 SCD  
    应对 SCD 的手段有很多种，如常用的拉链表等，这里不过多介绍，更多请参考 todo add link
  - DWD (Data Warehouse Details)   
    明细表中主要存放业务明细数据，在建模的过程中会做一些标准化处理，和维度退化处理：仅保留维度主键，在分析过程中，一个维度除了主键外，其他维度信息不参与计算，节省资源的同时，也可以让数据分析工作更加聚焦在业务，不受其他维度信息的干扰。   
    
  - DWS (Data Warehouse Service)  
    数据服务层按照部门的业务需求进行处理，产生的结果是针对特定主体的，如按雪花模型或星型模型做关联形成大宽表，便于进一步的数据分析，或按照特定维度(如以年/月的时间维度)做聚合，形成相对公共的汇总数据等。 
  
- ADS 层
ADS(Application Data Store)层，是面向应用的最顶层，上层应用直接从ADS层获取特定需求的结果数据，无需再在上层应用做额外的计算。  
由于对接各种各样的上层应用，ADS层的数据也是多种多样，有按维度深度汇总的报表数据，便于BI团队做可视化；有按照业务属性将DWS表做深度关联，便于OLAP团队做即席查询，便于ML团队做数据挖掘；也有按指标模型构建的标签数据，方便运营团队做精细化运营，进准营销等等。  
理想的情况，上层应用的每一个报表、或者其他依赖数据的服务，都对应着一张ADS层单独的表。

从上述的分层结构可以看出，数据仓库有着非常规范的结构，和较高的数据质量。  
但缺点也比较明显，数仓团队需要为每一个特定主题的数据来在不同层级构建不同的表，从需求提出，到数据可用，所经历的周期相对较长。 
数据基本上都是外部系统中的结构化数据，且都是现有需求再建模，整体提供的数据服务能力呈收敛的状态，相对不太容易能挖掘出更多的价值。  
为了解决这些痛点，数据湖的架构慢慢发展起来。  

##### 数据湖
数据湖(Data Lake)名字也比较形象，顾名思义它可以容纳各种各样的数据，如结构化数据(Table)、半结构化数据(JSON、XML、HTML)以及非结构化数据(文件，音频，视频等)  
数据湖通常会统一存储企业的所有数据，既包括采集后的原始数据，也包括转换后的数据，转换的层级可以很少（甚至为零），也可以按照严格的层级进行建模，故而数据仓库可以是数据湖的一个真子集，也就是常见的湖仓一体架构。  
也因为可以不受严格的层级约束，数据入湖提供服务的技术成本和时间成本都大大降低，数据湖可以很轻松地整合各种各样的企业内部数据或者第三方数据，从而打破数据孤岛；同时视数据的情况可以按需进行数据转换，甚至在数据比较规范及安全的情况下，无需转换直接向下游提供数据服务，加速数据产生价值的时间。  
所以数据湖相对于数据仓库来说，可以面向任意业务，授权用户可以以任意速度，任意语言，访问数据湖的任意层级的数据。
广义上的数据湖是一套架构，一套体系，一套完整的方法论，而狭义上的数据湖则是由这套架构催化的存储数据的具体的技术组件。
离线数据仓库中的操作多为文件操作，仅支持读和写，不支持更新；即使可以通过逻辑层面实现更新的功能，本质上也是将整个文件删除和覆写，延迟相对较高，在准实时场景下容易成为性能瓶颈。  
行业头部公司为了解决这些痛点，各自出现了自己的解决方案，比较知名的 Databrics 的 Dalta Lake，Uber 开源的 Hudi，Netflix 开源的 Iceberg，也就是常说的"数据湖三剑客"。  
它们的核心都是定义了一种全新的表格式，即在对分布式文件系统之上做了一层封装，对文件进行标记，区分有效数据或已删除数据，通过引入一级索引文件和二级索引文件来对数据进行文件级的过滤和整合，从而实现快速ACID的语义。  




###### 数据中台
- 数据中台
  - 以一种标准的、安全的、可靠的、统一的、共享的、解耦的、服务化的方式支持前端数据的应用。

#### 数据产品

- 数据即产品，为用户产生直接或间接的价值
    - 包括但不限于上述数据平台
    - CRM: Custom Relationship Management
        - 特点
            - https://www.fxiaoke.com/crm/information-13747.html#:~:text=%E5%B8%82%E5%9C%BA%E4%B8%8A%E6%9C%89SaaS%E5%9E%8B,TOB%E3%80%81TOC%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F%E3%80%82
            - 管理上下游之间的数据
            - 高时效性：业务数据低延迟
        - 使用场景
            - 营销，销售等领域的客户管理、上下游/供应链管理等
        - 架构设计
            - 微服务 + 传统数据库
        - 案例:
            - 纷享销客CRM, Salesforce, Zuora
    - DMP
        - 特点
            - 管理用户标签数据
            -
        - 使用场景
        - 架构设计
        - 案例
            - 淘宝-达摩盘, 抖音-巨量千川
    - CDP
        - 特点
        - 使用场景
        - 架构设计
        - 案例
            - GENE DataLake - MCDP
    - 如何选择不同的数据产品
        - 取决于你是谁
        - 取决于你要做什么，当下和未来 战略计划

### 数据工程的价值

- 数据工程的定位
  - 一般企业是如何盈利的, 由钱生钱的抓手/切入点？
    - 商贸企业： 进 -> 销，成本低，利润低：商店，超市，服装代销 等
    - 生产企业： 进原材料 -> 加工 -> 销，成本低，利润高： 产品型公司，护肤品，服装厂商等
    - 互联网企业： 开发 -> 按使用收费: 边际成本低，用户多，利润高：电商平台，外卖平台，内容平台
  - 数据工程如何创造价值？
    - 直接价值: 少数 -> 待开荒
      - 提供数据赋能服务: 如 CRM-SaaS， DMP中的数据包
  - 间接价值: 多数 -> 现状
    - 数据分析和挖掘， 数据从业务中来，反哺到业务中去，降本增效，优化现有业务
      - CRM: 精细化运营，提升运营效率，提升用户粘性，淘汰低ROI业务线等
      - DMP: 精准营销, 广告投放
      - CDP: CRM + DMP + More： 风险预警，数据分析和挖掘，ML + AI等。
    - 业务资产化，资产或能力复用，重组新的业务线
      - 数据中台 - 组合式创新, 如盒马鲜生的诞生：
        - https://developer.aliyun.com/article/717510
        - https://finance.sina.com.cn/chanjing/gsnews/2020-12-23/doc-iiznezxs8527037.shtml
        - https://zhuanlan.zhihu.com/p/340014118
    - AI ？
      - TODO：总结归纳历史 -> 预测未来、辐射赋能
